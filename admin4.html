<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404 - Page Not Found</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg: #05080f; --sidebar: #0b1224; --text: #ffffff;
            --accent: #00d4ff; --card: #111827; --border: #1f2937;
            --gold: #fbbf24; --success: #10b981; --error: #ef4444; --purple: #a855f7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* --- FAKE 404 PAGE --- */
        #fake404 {
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; text-align: center;
        }
        #errorTitle { font-size: 8rem; margin: 0; color: var(--error); opacity: 0.2; cursor: default; user-select: none; }
        .fake-p { font-size: 1.2rem; opacity: 0.5; max-width: 400px; line-height: 1.6; }
        .home-btn { 
            margin-top: 30px; color: var(--accent); text-decoration: none; 
            border: 1px solid var(--accent); padding: 12px 25px; border-radius: 12px; font-weight: bold;
        }

        /* --- ACTUAL ADMIN PANEL --- */
        #adminApp { display: none; height: 100vh; width: 100%; }
        
        /* Sidebar */
        nav.sidebar { 
            width: 260px; background: var(--sidebar); height: 100vh; 
            padding: 40px 20px; border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--error); margin-bottom: 30px; letter-spacing: 1px; text-align: center; }
        .nav-link { 
            background: transparent; border: none; color: var(--text); padding: 12px 15px; 
            margin-bottom: 8px; border-radius: 12px; display: flex; align-items: center; gap: 10px; font-weight: 600; opacity: 0.7; cursor: pointer; text-align: left; font-size: 1rem;
        }
        .nav-link:hover, .nav-link.active { background: rgba(239, 68, 68, 0.1); color: var(--error); opacity: 1; border: 1px solid var(--error); }

        /* Main Content */
        main { flex: 1; padding: 40px; overflow-y: auto; background: var(--bg); }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .header-bar h1 { color: var(--error); font-size: 2rem; }
        
        /* Data Cards & Tables */
        .admin-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: #64748b; font-size: 0.8rem; text-transform: uppercase; padding: 12px 10px; border-bottom: 2px solid var(--border); }
        td { padding: 15px 10px; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
        
        .badge { padding: 5px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; }
        .b-winner { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
        .b-junk { background: rgba(239, 68, 68, 0.2); color: var(--error); border: 1px solid var(--error); }
        .b-pending { background: rgba(251, 191, 36, 0.2); color: var(--gold); border: 1px solid var(--gold); }

        .action-btn { background: var(--card); border: 1px solid var(--border); color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; transition: 0.2s; }
        .action-btn:hover { filter: brightness(1.5); }
        .btn-win { border-color: var(--success); color: var(--success); }
        .btn-junk { border-color: var(--error); color: var(--error); }

        .control-panel { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; background: rgba(255,255,255,0.02); padding: 15px; border-radius: 12px; border: 1px dashed var(--accent); }
        .control-panel input { padding: 10px 15px; border-radius: 8px; border: 1px solid var(--border); background: #000; color: white; outline: none; }
    </style>
</head>
<body>

    <div id="fake404">
        <h1 id="errorTitle">404</h1>
        <p class="fake-p">Oops! The page you are looking for doesn't exist or has been moved.</p>
        <a href="index.html" class="home-btn">Return Home</a>
    </div>

    <div id="adminApp">
        <nav class="sidebar">
            <div class="logo"><i class="fas fa-shield-alt"></i> GOD MODE</div>
            <button class="nav-link active" onclick="switchTab('users', this)"><i class="fas fa-users"></i> Global Economy</button>
            <button class="nav-link" onclick="switchTab('giveaways', this)"><i class="fas fa-gift"></i> Giveaway Manager</button>
            <button class="nav-link" onclick="switchTab('quizzes', this)"><i class="fas fa-check-circle"></i> Quiz Verifications</button>
            <button class="nav-link" onclick="switchTab('logs', this)"><i class="fas fa-list"></i> Live Activity Logs</button>
            
            <div style="margin-top: auto;">
                <button class="nav-link" style="color:var(--error);" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> Lock Terminal</button>
            </div>
        </nav>

        <main>
            <div class="header-bar">
                <h1 id="tabTitle">Global Economy</h1>
                <div style="opacity: 0.6; font-size: 0.9rem;"><i class="fas fa-database"></i> Connected to Firebase</div>
            </div>

            <div id="tab-users" class="admin-card" style="display: block;">
                <h2>Registered Players</h2>
                <p style="opacity: 0.6; margin-bottom: 15px;">View all accounts, passwords, and coin balances.</p>
                <table>
                    <thead><tr><th>Username</th><th>Password</th><th>Coins</th><th>Verified</th></tr></thead>
                    <tbody id="usersTableBody"><tr><td colspan="4" style="text-align:center;">Loading data...</td></tr></tbody>
                </table>
            </div>

            <div id="tab-giveaways" class="admin-card" style="display: none;">
                <h2>Giveaway Sorter</h2>
                <div class="control-panel">
                    <label style="font-weight:bold; color:var(--accent);">Master Code:</label>
                    <input type="text" id="masterCode" placeholder="Enter video code here..." oninput="renderGiveaways()">
                    <span style="opacity: 0.6; font-size: 0.85rem;">(Matches will highlight green, wrongs highlight red)</span>
                </div>
                <table>
                    <thead><tr><th>Player</th><th>Submitted Code</th><th>Status</th><th>Actions</th></tr></thead>
                    <tbody id="gwTableBody"><tr><td colspan="4" style="text-align:center;">Loading data...</td></tr></tbody>
                </table>
            </div>

            <div id="tab-quizzes" class="admin-card" style="display: none;">
                <h2>Completed Verifications</h2>
                <table>
                    <thead><tr><th>Player</th><th>Age</th><th>Game</th><th>Fav Fruit</th><th>Date</th></tr></thead>
                    <tbody id="quizTableBody"><tr><td colspan="5" style="text-align:center;">Loading data...</td></tr></tbody>
                </table>
            </div>

            <div id="tab-logs" class="admin-card" style="display: none;">
                <h2>Live Activity (Gifts & Spins)</h2>
                <table>
                    <thead><tr><th>Type</th><th>Player</th><th>Action / Details</th><th>Time</th></tr></thead>
                    <tbody id="logsTableBody"><tr><td colspan="4" style="text-align:center;">Loading data...</td></tr></tbody>
                </table>
            </div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, get, child, update, onValue } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA0am45IuFAWXViWjnZiDPsddmbPUF3rZY",
            authDomain: "fatblox-43609.firebaseapp.com",
            projectId: "fatblox-43609",
            storageBucket: "fatblox-43609.firebasestorage.app",
            messagingSenderId: "104409498644",
            appId: "1:104409498644:web:ca1d5ecd367ec0fcd85301",
            databaseURL: "https://fatblox-43609-default-rtdb.firebaseio.com/" 
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Expose DB to window for inline onclick functions
        window.dbRef = ref(db);
        window.update = update;

        // --- THE 404 DISGUISE LOGIC ---
        let clicks = 0;
        let unlocked = false;
        
        document.getElementById('errorTitle').addEventListener('click', () => {
            clicks++; 
            if(clicks === 3) { 
                let p = prompt("AUTHORIZATION REQUIRED:");
                if(p === "FatBloxNOOB") {
                    document.getElementById('fake404').style.display = 'none';
                    document.getElementById('adminApp').style.display = 'flex';
                    document.body.style.overflow = 'auto';
                    unlocked = true;
                    startRealtimeListeners();
                } else {
                    alert("ACCESS DENIED");
                }
                clicks = 0; 
            } 
            setTimeout(() => { if(!unlocked) clicks = 0; }, 2000);
        });

        // --- TAB SWITCHER ---
        window.switchTab = function(tabId, btn) {
            document.querySelectorAll('.admin-card').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).style.display = 'block';
            btn.classList.add('active');
            
            const titles = { 'users': 'Global Economy', 'giveaways': 'Giveaway Manager', 'quizzes': 'Quiz Verifications', 'logs': 'Live Activity Logs' };
            document.getElementById('tabTitle').innerText = titles[tabId];
        }

        // --- DATA CONTAINERS ---
        let rawUsers = {};
        let rawGiveaways = {};
        let rawQuizzes = {};
        let rawGifts = {};
        let rawSpins = {};

        // --- REALTIME LISTENERS ---
        function startRealtimeListeners() {
            // Listen to Users
            onValue(child(window.dbRef, 'users'), (snapshot) => {
                rawUsers = snapshot.val() || {};
                renderUsers();
            });

            // Listen to Giveaways
            onValue(child(window.dbRef, 'global_giveaways'), (snapshot) => {
                rawGiveaways = snapshot.val() || {};
                renderGiveaways();
            });

            // Listen to Quizzes
            onValue(child(window.dbRef, 'global_quizzes'), (snapshot) => {
                rawQuizzes = snapshot.val() || {};
                renderQuizzes();
            });

            // Listen to Logs
            onValue(child(window.dbRef, 'global_gifts'), (snap) => { rawGifts = snap.val() || {}; renderLogs(); });
            onValue(child(window.dbRef, 'global_spins'), (snap) => { rawSpins = snap.val() || {}; renderLogs(); });
        }

        // --- RENDER FUNCTIONS ---
        function renderUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = "";
            let count = 0;
            for(let username in rawUsers) {
                count++;
                let u = rawUsers[username];
                let verified = u.verified ? '<span style="color:var(--success)"><i class="fas fa-check-circle"></i> Yes</span>' : '<span style="color:gray">No</span>';
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:bold; color:var(--accent);">${username}</td>
                        <td style="font-family:monospace; color:#fbbf24;">${u.password || 'N/A'}</td>
                        <td><i class="fas fa-coins" style="color:var(--gold)"></i> ${(u.coins || 0).toLocaleString()}</td>
                        <td>${verified}</td>
                    </tr>
                `;
            }
            if(count === 0) tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No users registered yet.</td></tr>`;
        }

        window.renderGiveaways = function() {
            const tbody = document.getElementById('gwTableBody');
            const masterCode = document.getElementById('masterCode').value.trim().toLowerCase();
            tbody.innerHTML = "";
            
            let arr = Object.keys(rawGiveaways).map(k => ({id: k, ...rawGiveaways[k]})).sort((a,b) => b.timestamp - a.timestamp);
            
            if(arr.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No entries yet.</td></tr>`;
                return;
            }

            arr.forEach(entry => {
                let statusBadge = `<span class="badge b-pending">PENDING</span>`;
                if(entry.status === 'winner') statusBadge = `<span class="badge b-winner">WINNER</span>`;
                if(entry.status === 'junk') statusBadge = `<span class="badge b-junk">JUNK</span>`;

                // Smart Highlighting based on Master Code
                let codeColor = "white";
                let submittedCode = entry.code.toLowerCase().trim();
                
                if (masterCode !== "") {
                    if (submittedCode === masterCode) codeColor = "var(--success)"; // Green match!
                    else codeColor = "var(--error)"; // Red mismatch!
                }

                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:bold;">${entry.username}</td>
                        <td style="color:${codeColor}; font-weight:bold; letter-spacing:1px;">${entry.code}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="action-btn btn-win" onclick="updateGiveaway('${entry.id}', 'winner')"><i class="fas fa-trophy"></i> Winner</button>
                            <button class="action-btn btn-junk" onclick="updateGiveaway('${entry.id}', 'junk')"><i class="fas fa-trash"></i> Junk</button>
                        </td>
                    </tr>
                `;
            });
        }

        window.updateGiveaway = async function(id, status) {
            try {
                let updates = {};
                updates[`global_giveaways/${id}/status`] = status;
                await update(window.dbRef, updates);
            } catch(e) { alert("Error updating status."); }
        }

        function renderQuizzes() {
            const tbody = document.getElementById('quizTableBody');
            tbody.innerHTML = "";
            let arr = Object.values(rawQuizzes).sort((a,b) => b.timestamp - a.timestamp);
            
            if(arr.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">No quizzes completed yet.</td></tr>`;
                return;
            }

            arr.forEach(q => {
                let date = new Date(q.timestamp).toLocaleDateString();
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:bold; color:var(--accent);">${q.username}</td>
                        <td>${q.age}</td>
                        <td>${q.game}</td>
                        <td style="color:var(--gold);">${q.fruit}</td>
                        <td style="opacity:0.6; font-size:0.8rem;">${date}</td>
                    </tr>
                `;
            });
        }

        function renderLogs() {
            const tbody = document.getElementById('logsTableBody');
            tbody.innerHTML = "";
            
            let combinedLogs = [];
            Object.values(rawGifts).forEach(g => combinedLogs.push({ type: 'GIFT', player: g.sender, detail: `Sent ${g.amount} to ${g.receiver}`, time: g.timestamp }));
            Object.values(rawSpins).forEach(s => combinedLogs.push({ type: 'SPIN', player: s.Username, detail: s.Detail, time: s.Timestamp }));
            
            combinedLogs.sort((a,b) => b.time - a.time); // Newest first

            if(combinedLogs.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No activity recorded yet.</td></tr>`;
                return;
            }

            combinedLogs.forEach(log => {
                let typeIcon = log.type === 'GIFT' ? '<span style="color:var(--success)"><i class="fas fa-gift"></i> Gift</span>' : '<span style="color:var(--purple)"><i class="fas fa-sync-alt"></i> Spin</span>';
                let date = new Date(log.time).toLocaleString();
                
                tbody.innerHTML += `
                    <tr>
                        <td>${typeIcon}</td>
                        <td style="font-weight:bold;">${log.player}</td>
                        <td>${log.detail}</td>
                        <td style="opacity:0.5; font-size:0.8rem;">${date}</td>
                    </tr>
                `;
            });
        }
    </script>
</body>
</html>