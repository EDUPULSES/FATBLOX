<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FATBLOX57 | Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script>
        if (sessionStorage.getItem("vault_access") !== "vault1") { window.location.href = "admin.html"; }
    </script>


    <style>
        :root { --bg: #05080f; --card: #111827; --text: #ffffff; --accent: #00d4ff; --border: #1f2937; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; }

        /* LOGIN */
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5,8,15,0.98); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .login-box { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid var(--border); text-align: center; width: 350px; }
        
        /* CONTAINER */
        .container { width: 100%; max-width: 900px; margin-top: 40px; display: none; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-bar { flex: 1; padding: 15px; background: var(--card); border: 1px solid var(--border); color: white; border-radius: 10px; }
        .refresh-btn { background: var(--accent); border: none; padding: 0 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        /* TABLE */
        .table-container { background: var(--card); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: #0f1523; color: var(--accent); font-size: 0.8rem; }
        
        /* BADGES */
        .fruit-tag { padding: 5px 12px; border-radius: 6px; font-weight: bold; font-size: 0.9rem; }
        .tag-mythic { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        .tag-legendary { background: rgba(236, 72, 153, 0.2); color: #ec4899; border: 1px solid rgba(236, 72, 153, 0.3); }
        .tag-rare { background: rgba(168, 85, 247, 0.2); color: #a855f7; border: 1px solid rgba(168, 85, 247, 0.3); }
        .tag-uncommon { background: rgba(59, 130, 246, 0.2); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
        .tag-common { background: rgba(156, 163, 175, 0.2); color: #9ca3af; border: 1px solid rgba(156, 163, 175, 0.3); }
        .tag-blank { background: rgba(255, 255, 255, 0.05); color: #666; border: 1px solid #333; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="color:var(--accent); margin-bottom:20px;">ADMIN LOGIN</h2>
            <input type="password" id="pass" style="width:100%; padding:10px; margin-bottom:20px; border-radius:5px; border:none;" placeholder="Password">
            <button onclick="login()" style="width:100%; padding:10px; background:var(--accent); border:none; border-radius:5px; font-weight:bold; cursor:pointer;">ENTER</button>
        </div>
    </div>

    <div class="container" id="main">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1>SPIN LOGS</h1>
            <a href="spin.html" style="color:white; background:#333; padding:10px 20px; text-decoration:none; border-radius:5px;">Back to Game</a>
        </div>

        <div class="controls">
            <input type="text" id="search" class="search-bar" placeholder="Search Username..." onkeyup="filter()">
            <button class="refresh-btn" onclick="fetchData()">REFRESH CLOUD</button>
        </div>

        <div class="table-container">
            <table>
                <thead><tr><th>USER</th><th>FRUIT</th><th>STATUS</th></tr></thead>
                <tbody id="tbody"><tr><td colspan="3" style="text-align:center; padding:30px;">Loading...</td></tr></tbody>
            </table>
        </div>
    </div>

    <script>
        const mythics = ["Kitsune", "Leopard", "Dragon", "Spirit", "Control", "Venom", "Shadow", "Dough", "T-Rex", "Mammoth", "Gravity"];
        const legendaries = ["Blizzard", "Pain", "Rumble", "Portal", "Phoenix", "Sound", "Spider", "Love", "Buddha", "Quake"];
        const rares = ["Magma", "Ghost", "Barrier", "Rubber", "Light", "Diamond", "Dark"]; // Simplified grouping

        function login() {
            if(document.getElementById('pass').value === "admin123") {
                document.getElementById('loginOverlay').style.display = "none";
                document.getElementById('main').style.display = "block";
                fetchData();
            } else alert("Wrong Password");
        }

        async function fetchData() {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; padding:30px;">Syncing...</td></tr>`;
            try {
                const res = await fetch("https://sheetdb.io/api/v1/otf617twr9im8");
                const data = await res.json();
                render(data);
            } catch(e) { tbody.innerHTML = `<tr><td colspan="3" style="color:red; text-align:center;">Cloud Error</td></tr>`; }
        }

        function render(data) {
            const tbody = document.getElementById('tbody');
            tbody.innerHTML = "";
            if(!data.length) return tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;">No Data</td></tr>`;

            [...data].reverse().forEach(row => {
                let user = row["Username"] || row["username"] || "Unknown";
                let fruit = row["fruit roll"] || row["fruit"] || "Unknown";
                
                let tag = "tag-common";
                if(fruit === "BLANK") tag = "tag-blank";
                else if(mythics.includes(fruit)) tag = "tag-mythic";
                else if(legendaries.includes(fruit)) tag = "tag-legendary";
                else if(rares.includes(fruit)) tag = "tag-rare";
                else if(["Sand","Ice","Falcon","Flame"].includes(fruit)) tag = "tag-uncommon";

                let tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight:bold;">${user}</td>
                    <td><span class="fruit-tag ${tag}">${fruit}</span></td>
                    <td style="color:#aaa;">Saved</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filter() {
            let val = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('#tbody tr').forEach(r => r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none");
        }
    </script>
</body>
</html>